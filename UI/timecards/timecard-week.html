<?lsmb INCLUDE "ui-header.html" dojo_parse='onload';
       PROCESS 'elements.html';
       PROCESS 'report_base.html';
       PROCESS 'utilities.html';
?>
<body class="lsmb <?lsmb dojo_theme ?>">
<form data-dojo-type="lsmb/Timecard-weekly" action="timecard.pl" method="post"
      data-dojo-props="topic:'/timecard/'"
>
<?lsmb 
PROCESS input element_data = {
    type = "hidden"
    name = "rowcount"
   value = 1 
};
?>
<?lsmb FOR dnum IN [0 .. 6];
FOR hidden IN ['id', 'parts_id', 'in_edit'];
PROCESS input element_data = {
    type = 'hidden'
    name = "$hidden_$dnum"
   value = request.$hidden.$dnum
};
END;
PROCESS input element_data = {
    type = 'hidden'
    name = "transdate_$dnum"
    value = request.transdates.$dnum
};
END;
FOREACH bu IN request.b_units;
    bu.text = bu.control_code _ ' -- ' _ bu.description;
END;
?>
<div class="listtop"><?lsmb text('Weekly Time and Materials Entry') ?></div>
<table width="100%" cols=7 id="timecard-weekly"><tbody>
<tr class="listtop">
<?lsmb FOR dnum IN [0 .. 6] ?>
 <th><?lsmb request.transdates.$dnum ?></th>
<?lsmb END; ?>
</tr>
<tr>
<tr>
<?lsmb FOR dnum IN [0 .. 6] ?>
<th class="listtop"><?lsmb text('Category') ?>&nbsp;:</th>
<?lsmb END ?>
</tr>
<tr>
<?lsmb FOR dnum IN [0 .. 6] ?>
    <td style="text-align:right" class="input_row" id="timecard_type_radios">
    <?lsmb
        PROCESS input element_data={
           value  = "by_time.$dnum" 
              id  = "timecard_by_time_$dnum" 
            name  = "timecard_type_$dnum",
           label  = text('Time') 
            type  = "radio"
         checked  = request.jctype.$dnum == 1 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type_$dnum'"
        }; ?><br><?lsmb
        PROCESS input element_data={
           value  = "by_materials.$dnum" 
              id  = "timecard_by_materials_$dnum" 
            name  = "timecard_type_$dnum",
           label  = text('Materials') 
            type  = "radio"
         checked  = request.jctype.$dnum == 2 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type_$dnum'"
        }; ?><br><?lsmb
        PROCESS input element_data={
           value  = "by_overhead.$dnum" 
              id  = "timecard_by_overhead_$dnum" 
            name  = "timecard_type_$dnum",
           label  = text('Overhead') 
            type  = "radio"
         checked  = request.jctype.$dnum == 3 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type_$dnum'"
        };
        ?>
    </td>
<?lsmb END ?>
</tr>
<?lsmb FOR lnum IN [1 .. num_lines] ?>
<tr>
<?lsmb FOR dnum IN [0 .. 6] ?>
<td>
     <div><?lsmb text('Report in') ?> </div>
     <div><?lsmb
        suffix = request.transdates.$dnum.replace('[./-]', '_') _ '_' _ lnum;
        PROCESS select element_data = {
                       name = "business_unit_id_$suffix"
             default_values = [request.${"business_unit_id_$suffix"}]
                    options = request.b_units
                  text_attr = 'text'
                 value_attr = 'id'
     } ?>
    </div>
  <div><?lsmb  text('Partnumber') ?></div>
  <div>
    <input data-dojo-type="lsmb/parts/PartSelector"
           data-dojo-props="required:false,channel:'/timecard/part-select/<?lsmb suffix ?>',fetchProperties:{type:'sales'}"
           name="partnumber_<?lsmb suffix ?>"
           id="partnumber_<?lsmb suffix ?>"
           size="15"
           value="<?lsmb request.${"partnumber_$suffix"} ?>"
           accesskey="p"
           title="[p]"
           class="control-code" />
    </div>
    <div><?lsmb text('Description') ?></div>
    <div data-dojo-type="lsmb/parts/PartDescription"
         data-dojo-props="channel:'/timecard/part-select/<?lsmb suffix ?>'"
         name="description_<?lsmb suffix ?>"
         id="description_<?lsmb suffix ?>"
         cols="15"
         class="description"><?lsmb request.${"description_$suffix"} ?></div>
<?lsmb IF request.jctype.$dnum == 1 OR request.jctype.$dnum == 3 ?>
    <div id='in-time'></div>
    <div><?lsmb text('Time In') ?></div>
    <div><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
           name = 'in_hour_$dnum'
             id = 'in-hour_$dnum'
          value = request.in_hour.$dnum
           type = 'text'
          class = 'time-part'
           size = 3
      maxlength = 2 } ?>&nbsp;: 
        <?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
           name = 'in_min_$dnum'
             id = 'in-min_$dnum'
          value = request.in_min.$dnum
           type = 'text'
          class = 'time-part'
           size = 3
    maxlength = 2 } ?>
     </div> 
    <div><?lsmb text('Time Out') ?></div>
    <div><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
           name = 'out_hour_$dnum'
             id = 'out-hour_$dnum'
          value = request.out_hour.$dnum
           type = 'text'
          class = 'time-part'
           size = 3
      maxlength = 2 } ?>&nbsp;: 
        <?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
           name = 'out_min_$dnum'
             id = 'out-min_$dnum'
          value = request.out_min.$dnum
           type = 'text'
          class = 'time-part'
           size = 3
      maxlength = 2 } ?>
     </div> 
    <div><?lsmb text('Clocked') ?></div>
    <div><?lsmb total ?></div>
<?lsmb END # if is_service or is_timecard ?>
  <div><?lsmb text('Chargeable') ?></div>
    <div><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/qty'"
       name = "qty_$suffix"
      value = request.${"qty_$suffix"}
      class = 'qty'
       size = 5 } ?></div>
  <div><?lsmb text('Extra Used') ?></div>
    <div><?lsmb PROCESS input element_data = {
       name = "non_billable_$suffix"
      value = request.${"non_billable_$suffix"}
      class = 'qty'
       size = 5 } ?></div>
    <div id='curr-lbl'><?lsmb text('Currency') ?></div>
    <div id='curr-input'><?lsmb 
        currencies2 = [];  
        FOREACH curr IN request.currencies;
           currencies2.push({text = curr, value = curr });
        END;

               PROCESS select element_data = {
                   name = "curr_$suffix"
                options = currencies2
         default_values = [request.${"curr_$suffix"}]
  "data-dojo-type" = "lsmb/PublishSelect"
 "data-dojo-props" = "topic:'/timecard/curr'"
       }; ?></div>
<tr><th><?lsmb text('Unit price') ?></th>
    <td><?lsmb PROCESS input element_data = {
         id = "unitprice_$suffix"
       name = "unitprice_$suffix"
      value = request.unitprice.$dnum
       type = 'text'
      class = 'qty'
  "data-dojo-type" = "lsmb/PublishNumberTextBox"
 "data-dojo-props" = "topic:'/timecard/unitprice'"
       size = 16 } ?></td>
</td>
<tr><th><?lsmb text('FX rate') ?></th>
    <td><?lsmb PROCESS input element_data = {
       name = "fxrate_$suffix"
      value = request.fxrate.$dnum
       type = 'text'
      class = 'qty'
       size = 16 } ?></td>
</td>
<tr><th><?lsmb text('Sell Price') ?></th>
    <td id=sellprice><?lsmb request.sellprice.$dnum ?></td>
</tr>
tr><th><?lsmb text('FX Sell Price') ?></th>
    <td id=fxsellprice.$dnum><?lsmb request.fxsellprice.$dnum ?></td>
</tr>
<tr><th><?lsmb text('Allocated') ?></th>
    <td><?lsmb request.allocated.$dnum ?></td>
</tr>
<tr><th align><?lsmb text('Notes') ?></th>
    <td colspan=3>
        <?lsmb PROCESS textarea element_data = {
                     name = "notes_$suffix"
                     rows = 2
                     cols = 46
                     wrap = "soft"
                     text = request.notes.$suffix } ?>
    </td>
</tr>
<?lsmb END ?>
</tr>
<?lsmb END ?>
</tbody></table>
<?lsmb IF id; 
    PROCESS print_options; 
END; ?>
<div id="buttons-div">
<?lsmb
    PROCESS button element_data = {
    text = text('Save')
    name = 'action'
   value = 'save_week'
    type = 'submit'
   class = 'submit'
};
IF id;
    PROCESS button element_data = {
       name = 'action'
      class = 'submit'
       text = text('Print')
       value = 'print'
       "data-dojo-type" = "lsmb/PrintButton"
   };
END;
?>
</div>
</form>
</body>
</html>
